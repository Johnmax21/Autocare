<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Service Requests</title>

<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>

body{margin:0;background:#0c0c0c;color:white;font-family:'Oswald',sans-serif;}

.header{
background:linear-gradient(90deg,#c9a227,#b8951f);
text-align:center;
padding:40px;
}

.container{padding:40px 80px;}

.stats{
display:grid;
grid-template-columns:repeat(4,1fr);
gap:20px;margin-bottom:35px;
}

.stat{
background:rgba(201,162,39,0.1);
border:1px solid #c9a227;
border-radius:15px;
padding:25px;
text-align:center;
}

.stat h2{color:#c9a227;margin:0;font-size:38px}

.request-search{
display:flex;
gap:15px;
background:rgba(201,162,39,0.1);
padding:18px;
border-radius:18px;
margin-bottom:35px;
}

.search-box{
flex:1;
display:flex;
background:rgba(255,255,255,0.05);
padding:12px 16px;
border-radius:12px;
align-items:center;
}

.search-box input{
flex:1;background:transparent;border:none;color:white;outline:none;
}

.filter{padding:10px 16px;border-radius:10px;border:none;background:#333;color:#ddd;cursor:pointer}
.filter.active{background:#c9a227;color:black}

.cards{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(400px,1fr));
gap:25px;
}

.card{
background:rgba(201,162,39,0.08);
border:1px solid #c9a227;
border-radius:16px;
padding:22px;
}

.user{
display:flex;gap:15px;margin:12px 0;background:rgba(255,255,255,0.05);padding:12px;border-radius:12px;
}

.avatar{
width:45px;height:45px;background:#c9a227;color:#000;
display:flex;align-items:center;justify-content:center;border-radius:50%;font-weight:bold;
}

.details{font-family:Arial;font-size:14px;opacity:.85}

.actions{display:flex;gap:12px;margin-top:15px;}

button{
flex:1;padding:12px;border:none;border-radius:10px;font-weight:bold;cursor:pointer;
}

.approve{background:#28a745}
.decline{background:#dc3545}

.status{
margin-top:10px;
font-family:Arial;
font-size:13px;
}

.pending{color:#ffc107}
.approved{color:#28a745}
.declined{color:#dc3545}

</style>
</head>
<body>

<div class="header">
<h1><i class="fas fa-wrench"></i> SERVICE REQUESTS</h1>
<p>Manage customer service requests</p>
</div>

<div class="container">

<!-- STATS -->
<div class="stats">
<div class="stat"><h2 id="total">0</h2>TOTAL</div>
<div class="stat"><h2 id="pending">0</h2>PENDING</div>
<div class="stat"><h2 id="approved">0</h2>APPROVED</div>
<div class="stat"><h2 id="declined">0</h2>DECLINED</div>
</div>

<!-- SEARCH + FILTER -->
<div class="request-search">

<div class="search-box">
<i class="fas fa-search"></i>&nbsp;
<input id="search" placeholder="Search requests...">
</div>

<button class="filter active" onclick="filterCards('all', this)">All</button>
<button class="filter" onclick="filterCards('pending', this)">Pending</button>
<button class="filter" onclick="filterCards('approved', this)">Approved</button>
<button class="filter" onclick="filterCards('declined', this)">Declined</button>


</div>

<!-- REQUESTS -->
<div class="cards" id="cards">

{% for b in bookings %}
<div class="card"
     data-status="{{ b.status|lower }}"
     data-name="{{ b.userd.username|lower }}"
     data-vehicle="{{ b.vehicle.vehicle_name|lower }}"
     data-service="{{ b.services|lower }}">


    <h3>Request #{{ b.id }}</h3>

    <div class="user">
        <div class="avatar">
            {{ b.userd.username|first|upper }}
        </div>
        <div>
            <b>{{ b.userd.username }}</b><br>
            <small>{{ b.userd.email }}</small>
        </div>
    </div>

    <div class="details">
        Vehicle: {{ b.vehicle.vehicle_name }} <br>
        Service: {{ b.services }} <br>
        Date: {{ b.booking_time }} <br>
        Payment: â‚¹{{ b.payment }}
    </div>

    <div class="status {{ b.status|lower }}">
        STATUS: {{ b.status|upper }}
    </div>

    <div class="actions">
        <a href="{% url 'update_booking_status' b.id 'Approved' %}">
            <button class="approve">APPROVE</button>
        </a>

        <a href="{% url 'update_booking_status' b.id 'Declined' %}">
            <button class="decline">DECLINE</button>
        </a>
    </div>

</div>
{% empty %}
<p>No service requests found.</p>
{% endfor %}

</div>


</div>

<script>

let currentFilter = "all";

function updateStats() {

    document.getElementById("total").innerText =
        document.querySelectorAll(".card").length;

    document.getElementById("pending").innerText =
        document.querySelectorAll(".card[data-status='pending']").length;

    document.getElementById("approved").innerText =
        document.querySelectorAll(".card[data-status='approved']").length;

    document.getElementById("declined").innerText =
        document.querySelectorAll(".card[data-status='declined']").length;
}

function filterCards(type, btn) {

    currentFilter = type;

    document.querySelectorAll(".filter").forEach(b =>
        b.classList.remove("active")
    );

    btn.classList.add("active");

    applyFilters();
}

function applyFilters() {

    const searchValue = document
        .getElementById("search")
        .value
        .toLowerCase();

    document.querySelectorAll(".card").forEach(card => {

        const statusMatch =
            currentFilter === "all" ||
            card.dataset.status === currentFilter;

        const searchMatch =
            card.dataset.name.includes(searchValue) ||
            card.dataset.vehicle.includes(searchValue) ||
            card.dataset.service.includes(searchValue);

        if (statusMatch && searchMatch) {
            card.style.display = "block";
        } else {
            card.style.display = "none";
        }

    });

}

document.getElementById("search")
    .addEventListener("keyup", applyFilters);

updateStats();

</script>


</body>
</html>